PICO-GPU.1
#----
@input var pos : Vec3;
@input var uv : Vec2;

@global var cameraViewProj : Mat4;

@param var light : Vec3;

@perInstance @input var offset : Vec4;
@perInstance @input var color : Vec4;

var outputPosition : Vec4;
var outputColor : Vec4;

var normal : Vec3;

function vertex() {
	normal = pos.normalize();
	outputPosition = vec4(pos + offset.xyz + uv.x*0,1) * cameraViewProj;
}

function fragment() {
	var l = light.dot(-normal).max(0.2);
	outputColor = vec4(l.xxx,1) * color;
}
#----
/*
	Instancing is technic that allows
	you to draw several meshes using
	a single draw call.
*/
var m = mat4();
var buffer = loadBuffer(0);
var m = mat4();
m.translate(0,0,30);

/*
 Create the instance buffer containing
  offset : vec4
  color : vec4
  these will be accessed as @perInstance
  inputs in the shaders 
*/
var ibuf = loadBuffer(1);
for( x in 0...16 )
	for( y in 0...16) {
		var idx = (x+y*16)*8;
		var pos = vec4(x-8,y-8);
		pos.scale4(1.5);
		ibuf.setVec(idx,pos);
		var col = vec3(rnd(),rnd(),rnd()).normalized();
		ibuf.setVec(idx+4,col.toVector4());
	}

function update() {
	clear(vec4(0.1,0.1,0.12,1));

	// update camera
	m.prependRotation(0.003,0.002,0.01);
	setCamera(m);

	// draw spheres
	cull(-1);
	setShader(0);
	setParam("light",vec3(0.5,0.2,1).normalized());
	drawInstance(buffer,ibuf,256);
}
#----
F:[0, 0, 1, 1, 0, 0.5, 0, 0.866025388240814, 1, 0.16666667163372, 0.353553384542465, 0.353553384542465, 0.866025388240814, 0.875, 0.16666667163372, 0, 0, 1, 0.875, 0, 0.353553384542465, 0.353553384542465, 0.866025388240814, 0.875, 0.16666667163372, 0, 0.5, 0.866025388240814, 0.75, 0.16666667163372, 0, 0, 1, 0.75, 0, 0, 0.5, 0.866025388240814, 0.75, 0.16666667163372, -0.353553384542465, 0.353553384542465, 0.866025388240814, 0.625, 0.16666667163372, 0, 0, 1, 0.625, 0, -0.353553384542465, 0.353553384542465, 0.866025388240814, 0.625, 0.16666667163372, -0.5, 0, 0.866025388240814, 0.5, 0.16666667163372, 0, 0, 1, 0.5, 0, -0.5, 0, 0.866025388240814, 0.5, 0.16666667163372, -0.353553384542465, -0.353553384542465, 0.866025388240814, 0.375, 0.16666667163372, 0, 0, 1, 0.375, 0, -0.353553384542465, -0.353553384542465, 0.866025388240814, 0.375, 0.16666667163372, 0, -0.5, 0.866025388240814, 0.25, 0.16666667163372, 0, 0, 1, 0.25, 0, 0, -0.5, 0.866025388240814, 0.25, 0.16666667163372, 0.353553384542465, -0.353553384542465, 0.866025388240814, 0.125, 0.16666667163372, 0, 0, 1, 0.125, 0, 0.353553384542465, -0.353553384542465, 0.866025388240814, 0.125, 0.16666667163372, 0.5, 0, 0.866025388240814, 0, 0.16666667163372, 0.353553384542465, 0.353553384542465, 0.866025388240814, 0.875, 0.16666667163372, 0.5, 0, 0.866025388240814, 1, 0.16666667163372, 0.61237245798111, 0.61237245798111, 0.5, 0.875, 0.333333343267441, 0.5, 0, 0.866025388240814, 1, 0.16666667163372, 0.866025388240814, 0, 0.5, 1, 0.333333343267441, 0.61237245798111, 0.61237245798111, 0.5, 0.875, 0.333333343267441, 0, 0.5, 0.866025388240814, 0.75, 0.16666667163372, 0.353553384542465, 0.353553384542465, 0.866025388240814, 0.875, 0.16666667163372, 0, 0.866025388240814, 0.5, 0.75, 0.333333343267441, 0.353553384542465, 0.353553384542465, 0.866025388240814, 0.875, 0.16666667163372, 0.61237245798111, 0.61237245798111, 0.5, 0.875, 0.333333343267441, 0, 0.866025388240814, 0.5, 0.75, 0.333333343267441, -0.353553384542465, 0.353553384542465, 0.866025388240814, 0.625, 0.16666667163372, 0, 0.5, 0.866025388240814, 0.75, 0.16666667163372, -0.61237245798111, 0.61237245798111, 0.5, 0.625, 0.333333343267441, 0, 0.5, 0.866025388240814, 0.75, 0.16666667163372, 0, 0.866025388240814, 0.5, 0.75, 0.333333343267441, -0.61237245798111, 0.61237245798111, 0.5, 0.625, 0.333333343267441, -0.5, 0, 0.866025388240814, 0.5, 0.16666667163372, -0.353553384542465, 0.353553384542465, 0.866025388240814, 0.625, 0.16666667163372, -0.866025388240814, 0, 0.5, 0.5, 0.333333343267441, -0.353553384542465, 0.353553384542465, 0.866025388240814, 0.625, 0.16666667163372, -0.61237245798111, 0.61237245798111, 0.5, 0.625, 0.333333343267441, -0.866025388240814, 0, 0.5, 0.5, 0.333333343267441, -0.353553384542465, -0.353553384542465, 0.866025388240814, 0.375, 0.16666667163372, -0.5, 0, 0.866025388240814, 0.5, 0.16666667163372, -0.61237245798111, -0.61237245798111, 0.5, 0.375, 0.333333343267441, -0.5, 0, 0.866025388240814, 0.5, 0.16666667163372, -0.866025388240814, 0, 0.5, 0.5, 0.333333343267441, -0.61237245798111, -0.61237245798111, 0.5, 0.375, 0.333333343267441, 0, -0.5, 0.866025388240814, 0.25, 0.16666667163372, -0.353553384542465, -0.353553384542465, 0.866025388240814, 0.375, 0.16666667163372, 0, -0.866025388240814, 0.5, 0.25, 0.333333343267441, -0.353553384542465, -0.353553384542465, 0.866025388240814, 0.375, 0.16666667163372, -0.61237245798111, -0.61237245798111, 0.5, 0.375, 0.333333343267441, 0, -0.866025388240814, 0.5, 0.25, 0.333333343267441, 0.353553384542465, -0.353553384542465, 0.866025388240814, 0.125, 0.16666667163372, 0, -0.5, 0.866025388240814, 0.25, 0.16666667163372, 0.61237245798111, -0.61237245798111, 0.5, 0.125, 0.333333343267441, 0, -0.5, 0.866025388240814, 0.25, 0.16666667163372, 0, -0.866025388240814, 0.5, 0.25, 0.333333343267441, 0.61237245798111, -0.61237245798111, 0.5, 0.125, 0.333333343267441, 0.5, 0, 0.866025388240814, 0, 0.16666667163372, 0.353553384542465, -0.353553384542465, 0.866025388240814, 0.125, 0.16666667163372, 0.866025388240814, 0, 0.5, 0, 0.333333343267441, 0.353553384542465, -0.353553384542465, 0.866025388240814, 0.125, 0.16666667163372, 0.61237245798111, -0.61237245798111, 0.5, 0.125, 0.333333343267441, 0.866025388240814, 0, 0.5, 0, 0.333333343267441, 0.61237245798111, 0.61237245798111, 0.5, 0.875, 0.333333343267441, 0.866025388240814, 0, 0.5, 1, 0.333333343267441, 0.70710676908493, 0.70710676908493, 0, 0.875, 0.5, 0.866025388240814, 0, 0.5, 1, 0.333333343267441, 1, 0, 0, 1, 0.5, 0.70710676908493, 0.70710676908493, 0, 0.875, 0.5, 0, 0.866025388240814, 0.5, 0.75, 0.333333343267441, 0.61237245798111, 0.61237245798111, 0.5, 0.875, 0.333333343267441, 0, 1, 0, 0.75, 0.5, 0.61237245798111, 0.61237245798111, 0.5, 0.875, 0.333333343267441, 0.70710676908493, 0.70710676908493, 0, 0.875, 0.5, 0, 1, 0, 0.75, 0.5, -0.61237245798111, 0.61237245798111, 0.5, 0.625, 0.333333343267441, 0, 0.866025388240814, 0.5, 0.75, 0.333333343267441, -0.70710676908493, 0.70710676908493, 0, 0.625, 0.5, 0, 0.866025388240814, 0.5, 0.75, 0.333333343267441, 0, 1, 0, 0.75, 0.5, -0.70710676908493, 0.70710676908493, 0, 0.625, 0.5, -0.866025388240814, 0, 0.5, 0.5, 0.333333343267441, -0.61237245798111, 0.61237245798111, 0.5, 0.625, 0.333333343267441, -1, 0, 0, 0.5, 0.5, -0.61237245798111, 0.61237245798111, 0.5, 0.625, 0.333333343267441, -0.70710676908493, 0.70710676908493, 0, 0.625, 0.5, -1, 0, 0, 0.5, 0.5, -0.61237245798111, -0.61237245798111, 0.5, 0.375, 0.333333343267441, -0.866025388240814, 0, 0.5, 0.5, 0.333333343267441, -0.70710676908493, -0.70710676908493, 0, 0.375, 0.5, -0.866025388240814, 0, 0.5, 0.5, 0.333333343267441, -1, 0, 0, 0.5, 0.5, -0.70710676908493, -0.70710676908493, 0, 0.375, 0.5, 0, -0.866025388240814, 0.5, 0.25, 0.333333343267441, -0.61237245798111, -0.61237245798111, 0.5, 0.375, 0.333333343267441, 0, -1, 0, 0.25, 0.5, -0.61237245798111, -0.61237245798111, 0.5, 0.375, 0.333333343267441, -0.70710676908493, -0.70710676908493, 0, 0.375, 0.5, 0, -1, 0, 0.25, 0.5, 0.61237245798111, -0.61237245798111, 0.5, 0.125, 0.333333343267441, 0, -0.866025388240814, 0.5, 0.25, 0.333333343267441, 0.70710676908493, -0.70710676908493, 0, 0.125, 0.5, 0, -0.866025388240814, 0.5, 0.25, 0.333333343267441, 0, -1, 0, 0.25, 0.5, 0.70710676908493, -0.70710676908493, 0, 0.125, 0.5, 0.866025388240814, 0, 0.5, 0, 0.333333343267441, 0.61237245798111, -0.61237245798111, 0.5, 0.125, 0.333333343267441, 1, 0, 0, 0, 0.5, 0.61237245798111, -0.61237245798111, 0.5, 0.125, 0.333333343267441, 0.70710676908493, -0.70710676908493, 0, 0.125, 0.5, 1, 0, 0, 0, 0.5, 0.70710676908493, 0.70710676908493, 0, 0.875, 0.5, 1, 0, 0, 1, 0.5, 0.61237245798111, 0.61237245798111, -0.5, 0.875, 0.666666686534882, 1, 0, 0, 1, 0.5, 0.866025388240814, 0, -0.5, 1, 0.666666686534882, 0.61237245798111, 0.61237245798111, -0.5, 0.875, 0.666666686534882, 0, 1, 0, 0.75, 0.5, 0.70710676908493, 0.70710676908493, 0, 0.875, 0.5, 0, 0.866025388240814, -0.5, 0.75, 0.666666686534882, 0.70710676908493, 0.70710676908493, 0, 0.875, 0.5, 0.61237245798111, 0.61237245798111, -0.5, 0.875, 0.666666686534882, 0, 0.866025388240814, -0.5, 0.75, 0.666666686534882, -0.70710676908493, 0.70710676908493, 0, 0.625, 0.5, 0, 1, 0, 0.75, 0.5, -0.61237245798111, 0.61237245798111, -0.5, 0.625, 0.666666686534882, 0, 1, 0, 0.75, 0.5, 0, 0.866025388240814, -0.5, 0.75, 0.666666686534882, -0.61237245798111, 0.61237245798111, -0.5, 0.625, 0.666666686534882, -1, 0, 0, 0.5, 0.5, -0.70710676908493, 0.70710676908493, 0, 0.625, 0.5, -0.866025388240814, 0, -0.5, 0.5, 0.666666686534882, -0.70710676908493, 0.70710676908493, 0, 0.625, 0.5, -0.61237245798111, 0.61237245798111, -0.5, 0.625, 0.666666686534882, -0.866025388240814, 0, -0.5, 0.5, 0.666666686534882, -0.70710676908493, -0.70710676908493, 0, 0.375, 0.5, -1, 0, 0, 0.5, 0.5, -0.61237245798111, -0.61237245798111, -0.5, 0.375, 0.666666686534882, -1, 0, 0, 0.5, 0.5, -0.866025388240814, 0, -0.5, 0.5, 0.666666686534882, -0.61237245798111, -0.61237245798111, -0.5, 0.375, 0.666666686534882, 0, -1, 0, 0.25, 0.5, -0.70710676908493, -0.70710676908493, 0, 0.375, 0.5, 0, -0.866025388240814, -0.5, 0.25, 0.666666686534882, -0.70710676908493, -0.70710676908493, 0, 0.375, 0.5, -0.61237245798111, -0.61237245798111, -0.5, 0.375, 0.666666686534882, 0, -0.866025388240814, -0.5, 0.25, 0.666666686534882, 0.70710676908493, -0.70710676908493, 0, 0.125, 0.5, 0, -1, 0, 0.25, 0.5, 0.61237245798111, -0.61237245798111, -0.5, 0.125, 0.666666686534882, 0, -1, 0, 0.25, 0.5, 0, -0.866025388240814, -0.5, 0.25, 0.666666686534882, 0.61237245798111, -0.61237245798111, -0.5, 0.125, 0.666666686534882, 1, 0, 0, 0, 0.5, 0.70710676908493, -0.70710676908493, 0, 0.125, 0.5, 0.866025388240814, 0, -0.5, 0, 0.666666686534882, 0.70710676908493, -0.70710676908493, 0, 0.125, 0.5, 0.61237245798111, -0.61237245798111, -0.5, 0.125, 0.666666686534882, 0.866025388240814, 0, -0.5, 0, 0.666666686534882, 0.61237245798111, 0.61237245798111, -0.5, 0.875, 0.666666686534882, 0.866025388240814, 0, -0.5, 1, 0.666666686534882, 0.353553384542465, 0.353553384542465, -0.866025388240814, 0.875, 0.833333313465118, 0.866025388240814, 0, -0.5, 1, 0.666666686534882, 0.5, 0, -0.866025388240814, 1, 0.833333313465118, 0.353553384542465, 0.353553384542465, -0.866025388240814, 0.875, 0.833333313465118, 0, 0.866025388240814, -0.5, 0.75, 0.666666686534882, 0.61237245798111, 0.61237245798111, -0.5, 0.875, 0.666666686534882, 0, 0.5, -0.866025388240814, 0.75, 0.833333313465118, 0.61237245798111, 0.61237245798111, -0.5, 0.875, 0.666666686534882, 0.353553384542465, 0.353553384542465, -0.866025388240814, 0.875, 0.833333313465118, 0, 0.5, -0.866025388240814, 0.75, 0.833333313465118, -0.61237245798111, 0.61237245798111, -0.5, 0.625, 0.666666686534882, 0, 0.866025388240814, -0.5, 0.75, 0.666666686534882, -0.353553384542465, 0.353553384542465, -0.866025388240814, 0.625, 0.833333313465118, 0, 0.866025388240814, -0.5, 0.75, 0.666666686534882, 0, 0.5, -0.866025388240814, 0.75, 0.833333313465118, -0.353553384542465, 0.353553384542465, -0.866025388240814, 0.625, 0.833333313465118, -0.866025388240814, 0, -0.5, 0.5, 0.666666686534882, -0.61237245798111, 0.61237245798111, -0.5, 0.625, 0.666666686534882, -0.5, 0, -0.866025388240814, 0.5, 0.833333313465118, -0.61237245798111, 0.61237245798111, -0.5, 0.625, 0.666666686534882, -0.353553384542465, 0.353553384542465, -0.866025388240814, 0.625, 0.833333313465118, -0.5, 0, -0.866025388240814, 0.5, 0.833333313465118, -0.61237245798111, -0.61237245798111, -0.5, 0.375, 0.666666686534882, -0.866025388240814, 0, -0.5, 0.5, 0.666666686534882, -0.353553384542465, -0.353553384542465, -0.866025388240814, 0.375, 0.833333313465118, -0.866025388240814, 0, -0.5, 0.5, 0.666666686534882, -0.5, 0, -0.866025388240814, 0.5, 0.833333313465118, -0.353553384542465, -0.353553384542465, -0.866025388240814, 0.375, 0.833333313465118, 0, -0.866025388240814, -0.5, 0.25, 0.666666686534882, -0.61237245798111, -0.61237245798111, -0.5, 0.375, 0.666666686534882, 0, -0.5, -0.866025388240814, 0.25, 0.833333313465118, -0.61237245798111, -0.61237245798111, -0.5, 0.375, 0.666666686534882, -0.353553384542465, -0.353553384542465, -0.866025388240814, 0.375, 0.833333313465118, 0, -0.5, -0.866025388240814, 0.25, 0.833333313465118, 0.61237245798111, -0.61237245798111, -0.5, 0.125, 0.666666686534882, 0, -0.866025388240814, -0.5, 0.25, 0.666666686534882, 0.353553384542465, -0.353553384542465, -0.866025388240814, 0.125, 0.833333313465118, 0, -0.866025388240814, -0.5, 0.25, 0.666666686534882, 0, -0.5, -0.866025388240814, 0.25, 0.833333313465118, 0.353553384542465, -0.353553384542465, -0.866025388240814, 0.125, 0.833333313465118, 0.866025388240814, 0, -0.5, 0, 0.666666686534882, 0.61237245798111, -0.61237245798111, -0.5, 0.125, 0.666666686534882, 0.5, 0, -0.866025388240814, 0, 0.833333313465118, 0.61237245798111, -0.61237245798111, -0.5, 0.125, 0.666666686534882, 0.353553384542465, -0.353553384542465, -0.866025388240814, 0.125, 0.833333313465118, 0.5, 0, -0.866025388240814, 0, 0.833333313465118, 0.353553384542465, 0.353553384542465, -0.866025388240814, 0.875, 0.833333313465118, 0.5, 0, -0.866025388240814, 1, 0.833333313465118, 0, 0, -1, 0.875, 1, 0, 0.5, -0.866025388240814, 0.75, 0.833333313465118, 0.353553384542465, 0.353553384542465, -0.866025388240814, 0.875, 0.833333313465118, 0, 0, -1, 0.75, 1, -0.353553384542465, 0.353553384542465, -0.866025388240814, 0.625, 0.833333313465118, 0, 0.5, -0.866025388240814, 0.75, 0.833333313465118, 0, 0, -1, 0.625, 1, -0.5, 0, -0.866025388240814, 0.5, 0.833333313465118, -0.353553384542465, 0.353553384542465, -0.866025388240814, 0.625, 0.833333313465118, 0, 0, -1, 0.5, 1, -0.353553384542465, -0.353553384542465, -0.866025388240814, 0.375, 0.833333313465118, -0.5, 0, -0.866025388240814, 0.5, 0.833333313465118, 0, 0, -1, 0.375, 1, 0, -0.5, -0.866025388240814, 0.25, 0.833333313465118, -0.353553384542465, -0.353553384542465, -0.866025388240814, 0.375, 0.833333313465118, 0, 0, -1, 0.25, 1, 0.353553384542465, -0.353553384542465, -0.866025388240814, 0.125, 0.833333313465118, 0, -0.5, -0.866025388240814, 0.25, 0.833333313465118, 0, 0, -1, 0.125, 1, 0.5, 0, -0.866025388240814, 0, 0.833333313465118, 0.353553384542465, -0.353553384542465, -0.866025388240814, 0.125, 0.833333313465118, 0, 0, -1, 0, 1, ]
F:[0.000000000][2048]